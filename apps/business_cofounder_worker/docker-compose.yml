version: '3.8'

services:
  worker:
    build:
      context: ../..
      dockerfile: apps/business_cofounder_worker/Dockerfile
    container_name: business-cofounder-worker
    env_file:
      - .docker.env
    environment:
      # Persist checkpoints + skills under /home/celery/.deepagents by default
      - HOME=/home/celery
    user: "1000:1000"  # Run as non-root user (celery, UID 1000)
    volumes:
      - ../business_cofounder_api/.tmp_home/.deepagents:/home/celery/.deepagents
    restart: unless-stopped
    # Use solo pool to avoid thread creation issues
    command: ["celery", "-A", "apps.business_cofounder_worker.celery_app", "worker", "--loglevel=info", "--pool=prefork"]

